---
title: "Predicting and Understanding NBA Career Length"
author: "Brandon Chan + Lucas Duncan"
date: "2025-03-07"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(e1071)
library(MASS)
library(tidyverse)
library(caret)
select <- dplyr::select
```

## Executive Summary and Contents

```{r}
contents <- tribble(
  ~Index, ~Category, ~Method,
  1, "Introduction", "Written",
  2, "Preprocessing", "Data Description and Encoding",
  3, "Unsupervised Learning/Analysis", "PCA and Clustering",
  4, "Preprocessing", "Variable Selection",
  5, "Supervised Regression", "Linear and Non-Linear Regression",
  6, "Supervised Classification", "LDA/QDA and Logistic Regression",
  7, "Supervised Classification", "Tree-Based Methods",
  8, "Supervised Classification", "Support Vector Machines",
  9, "Deep Learning", "Neural Networks",
  10, "Conclusion", "Written", 
)
contents

```


# 1 Preprocessing

#1.1 Extract Data
```{r, include=FALSE}
# Load data from GitHub and preprocess 
df <- read_csv("https://raw.githubusercontent.com/BrandonYChan/Statistical-Learning/main/basketball_career_length.csv")


```

#1.2 Mutate Dataframe For Analysis
```{r, echo=FALSE}

format="%B %d, %Y"

df2 <- df |>
  
       rename(
         #Renaming Ambiguous Status Variable
         "retired" = "status"     
       ) |>
       mutate(
         #Convert BirthDate To Year
         birth_date = as.Date(birth_date,format),  
         
         #Store Age At Start
         age = start_year - year(birth_date),  
         
         #Convert Retired,HallOfFame To Integer
         retired = as.integer(retired),                         
         hall_of_fame = as.integer(hall_of_fame)
       ) |>
  
       #One Hot Encoding Categorical Variable (positions)
       bind_cols(as.data.frame(model.matrix(~ positions - 1, data = df))) |>  
  
       #Removing Redundant And Non Numeric
       select(-c(
                 name,   #Not Important To Model
                 sport,  #All Identical
                 end_year, #Redundant As Start,Duration Already Stored
                 positions, #Expanded With One Hot
                 birth_date  #Redundant As Start,Age Already Stored
                 ))
```
#1.3 Filter Data + Handle Missing
```{r}
#Remove Duplicate Rows
df3 <- distinct(df2)

#Replace Missing NUMERIC (Including Date) Values With ColMean
if (any(is.na(df3))) {
  df3[] <- lapply(df3, function(x) {
    if (is.numeric(x)) {
      replace(x, is.na(x), mean(x, na.rm = TRUE))
    } else {
      x
    }
  })
}
```

#1.4 Display Final Format
```{r}
df3[sample(nrow(df3), size = 10), ]
```

#1.5 Predictor Distribution:
```{r}

data_long <- pivot_longer(df3, cols = everything())

ggplot(data_long, aes(x = value, fill = name)) +
  geom_histogram(bins = 20, position = "identity") +
  facet_wrap(~ name, scales = "free") +
  labs(title = "Predictor Distributions", x = "Value", y = "Frequency")
```






# 2 Data Exploration with Unsupervised Methods 


##2.1 Principal Component Analysis

```{r}

# Find Principal Components
pr <- prcomp(df3, scale=TRUE)

pc1 <- pr$rotation[,1]

# Show Impact of Variables on the First Principle Component
pc1_loading_df <- cbind(names(pc1), as_data_frame(pc1)) %>% # Join names and loadings to form columns in the dataframe
  rename("names" = "names(pc1)", "pc1_loading" = "value") %>%  
  arrange(desc(abs(pc1_loading)))

pc1_loading_df
```


```{r}
# Show Proportion of Variance Explained (PVE)
pve <- pr$sdev^2 / sum(pr$sdev^2)   

pve_df <- as_data_frame(cbind(1:length(pve), pve)) %>% # Show PVE for each number of principal components
  mutate(cumulative_pve = cumsum(pve)) %>% # Cumulative PVE for each additional PC 
  rename("num_principal_components" = "V1")
  
pve_df
```


```{r}
# Show projections of data onto first 2 PCs
biplot(pr, scale = 0, cex=0.4)
```

## K-Means Clustering on PC1 and PC2

```{r}
km <- kmeans(pr$x, 3, nstart=20)
plot(pr$x, col = (km$cluster +1), pch=20, cex=2)
```











